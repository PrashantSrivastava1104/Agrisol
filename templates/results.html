{% extends 'base.html' %}

{% block content %}
<section class="section">
    <h2 class="section-title">‚úÖ Prediction Results</h2>

    <!-- Crop Prediction Results -->
    {% if result.predicted_crop %}
    <div class="card result-card">
        <div class="result-header">
            <div class="result-icon crop-icon">üåæ</div>
            <div class="result-title">
                <h3>Recommended Crop</h3>
                <p class="result-subtitle">Based on your soil and climate parameters</p>
            </div>
        </div>

        <div class="result-main">
            <div class="crop-name">{{ result.predicted_crop | title }}</div>
            <div class="confidence-section">
                <div class="confidence-label">Prediction Confidence</div>
                <div class="confidence-bar-container">
                    <div class="confidence-bar" style="width: {{ (result.confidence * 100) | round(1) }}%">
                        <span class="confidence-text">{{ (result.confidence * 100) | round(1) }}%</span>
                    </div>
                </div>
                <div class="confidence-indicator">
                    {% if result.confidence >= 0.8 %}
                    <span class="badge badge-high">High Confidence</span>
                    {% elif result.confidence >= 0.6 %}
                    <span class="badge badge-medium">Medium Confidence</span>
                    {% else %}
                    <span class="badge badge-low">Low Confidence</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Crop Comparison Section -->
    {% if result.all_crops and result.all_crops|length > 1 %}
    <div class="card comparison-card">
        <div class="comparison-header">
            <h3>üîç Compare with Other Crops</h3>
            <p class="comparison-subtitle">See how other crops rank for your conditions</p>
        </div>

        <div class="comparison-body">
            <div class="crop-selector">
                <label for="crop-compare">Select a crop to compare:</label>
                <select id="crop-compare" class="crop-dropdown">
                    {% for crop in result.all_crops[1:] %}
                    <option value="{{ loop.index0 }}" data-confidence="{{ (crop.confidence * 100) | round(1) }}">
                        {{ crop.name | title }} - {{ (crop.confidence * 100) | round(1) }}%
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div id="comparison-view" class="comparison-grid">
                <!-- Recommended crop column -->
                <div class="comparison-column recommended">
                    <div class="column-badge">Recommended</div>
                    <h4>{{ result.predicted_crop | title }}</h4>
                    <div class="confidence-display">{{ (result.confidence * 100) | round(1) }}%</div>
                    <span class="confidence-label">Confidence</span>
                </div>

                <!-- Selected crop column -->
                <div class="comparison-column alternative">
                    <div class="column-badge">Alternative</div>
                    <h4 id="alt-crop-name">{{ result.all_crops[1].name | title }}</h4>
                    <div class="confidence-display" id="alt-confidence">{{ (result.all_crops[1].confidence * 100) |
                        round(1) }}%</div>
                    <span class="confidence-label">Confidence</span>
                </div>
            </div>

            <div class="all-crops-list">
                <div class="rankings-header"
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h4 style="margin: 0;">All Crop Rankings</h4>
                    <button class="toggle-rankings-btn btn-sm" onclick="toggleCropRankings()"
                        style="background: transparent; border: 1px solid var(--primary-color); color: var(--primary-color); cursor: pointer; padding: 0.25rem 0.75rem; border-radius: 20px; font-weight: 500;">
                        <span id="rankings-toggle-icon">‚ñº</span> Show Details
                    </button>
                </div>

                <div id="crop-rankings-content" style="display: none;">
                    <div class="crops-ranking">
                        {% for crop in result.all_crops %}
                        <div class="rank-item">
                            <span class="rank-number">#{{ loop.index }}</span>
                            <span class="rank-crop">{{ crop.name | title }}</span>
                            <div class="rank-bar-container">
                                <div class="rank-bar" style="width: {{ (crop.confidence * 100) | round(1) }}%"></div>
                            </div>
                            <span class="rank-confidence">{{ (crop.confidence * 100) | round(1) }}%</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('crop-compare').addEventListener('change', function () {
            const allCrops = {{ result.all_crops | tojson
        }};
        const selectedIndex = parseInt(this.value) + 1; // +1 because we skip index 0 (recommended)
        const selectedCrop = allCrops[selectedIndex];

        document.getElementById('alt-crop-name').textContent = selectedCrop.name.charAt(0).toUpperCase() + selectedCrop.name.slice(1);
        document.getElementById('alt-confidence').textContent = (selectedCrop.confidence * 100).toFixed(1) + '%';
    });
    </script>
    {% endif %}
    {% endif %}

    <!-- Model Comparison Section -->
    {% if result.model_predictions and result.model_predictions|length > 0 %}
    <div class="card model-comparison-card">
        <div class="model-comparison-header">
            <h3>üìä Model Comparison (Research Analysis)</h3>
            <p class="model-comparison-subtitle">See how different ML algorithms perform on your input</p>
            <button class="toggle-comparison-btn" onclick="toggleModelComparison()">
                <span id="toggle-icon">‚ñº</span> Show Details
            </button>
        </div>

        <div id="model-comparison-content" class="model-comparison-content" style="display: none;">
            <!-- Model Predictions Table -->
            <div class="model-predictions-section">
                <h4>Predictions for Your Input</h4>
                <div class="predictions-table">
                    <div class="predictions-header">
                        <div class="pred-col-model">Model</div>
                        <div class="pred-col-crop">Predicted Crop</div>
                        <div class="pred-col-confidence">Confidence</div>
                        <div class="pred-col-match">Match</div>
                    </div>
                    {% for model_name, prediction in result.model_predictions.items() %}
                    <div class="prediction-row">
                        <div class="pred-col-model">
                            <span class="model-name">{{ model_name.replace('_', ' ').title() }}</span>
                        </div>
                        <div class="pred-col-crop">
                            <span class="crop-name-pred">{{ prediction.crop | title }}</span>
                        </div>
                        <div class="pred-col-confidence">
                            <div class="mini-confidence-bar">
                                <div class="mini-bar" style="width: {{ (prediction.confidence * 100) | round(1) }}%">
                                </div>
                            </div>
                            <span class="confidence-value">{{ (prediction.confidence * 100) | round(1) }}%</span>
                        </div>
                        <div class="pred-col-match">
                            {% if prediction.crop.lower() == result.predicted_crop.lower().split('/')[0] %}
                            <span class="match-badge match-yes">‚úì Match</span>
                            {% else %}
                            <span class="match-badge match-no">‚úó Different</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Model Performance Metrics -->
            {% if result.model_metrics and result.model_metrics|length > 0 %}
            <div class="model-metrics-section">
                <h4>Model Performance Metrics</h4>
                <p class="metrics-subtitle">Validation set performance (trained on historical data)</p>
                <div class="metrics-table">
                    <div class="metrics-header">
                        <div class="metric-col-model">Model</div>
                        <div class="metric-col-accuracy">Accuracy</div>
                        <div class="metric-col-precision">Precision</div>
                        <div class="metric-col-recall">Recall</div>
                        <div class="metric-col-f1">F1 Score</div>
                    </div>
                    {% for model_name, metrics in result.model_metrics.items() %}
                    <div class="metric-row">
                        <div class="metric-col-model">
                            <span class="model-name">{{ model_name.replace('_', ' ').title() }}</span>
                        </div>
                        <div class="metric-col-accuracy">
                            <span class="metric-value">{{ (metrics.val_accuracy * 100) | round(1) }}%</span>
                        </div>
                        <div class="metric-col-precision">
                            <span class="metric-value">{{ (metrics.precision * 100) | round(1) }}%</span>
                        </div>
                        <div class="metric-col-recall">
                            <span class="metric-value">{{ (metrics.recall * 100) | round(1) }}%</span>
                        </div>
                        <div class="metric-col-f1">
                            <span class="metric-value">{{ (metrics.f1_score * 100) | round(1) }}%</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Visual Charts Section -->
            <div class="model-charts-section">
                <h4>üìà Visual Comparison</h4>
                <div class="charts-grid">
                    <!-- Confidence Comparison Chart -->
                    <div class="chart-container">
                        <h5>Prediction Confidence Comparison</h5>
                        <canvas id="confidenceChart"></canvas>
                    </div>

                    <!-- Performance Metrics Chart -->
                    <div class="chart-container">
                        <h5>Model Performance Metrics</h5>
                        <canvas id="metricsChart"></canvas>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script>
        let confidenceChart = null;
        let metricsChart = null;

        function toggleModelComparison() {
            const content = document.getElementById('model-comparison-content');
            const icon = document.getElementById('toggle-icon');
            const btn = document.querySelector('.toggle-comparison-btn');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
                btn.innerHTML = '<span id="toggle-icon">‚ñ≤</span> Hide Details';
                // Initialize charts when showing
                setTimeout(initializeCharts, 100);
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
                btn.innerHTML = '<span id="toggle-icon">‚ñº</span> Show Details';
            }
        }



        function toggleCropRankings() {
            const content = document.getElementById('crop-rankings-content');
            const icon = document.getElementById('rankings-toggle-icon');
            const btn = document.querySelector('.toggle-rankings-btn');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
                btn.innerHTML = '<span id="rankings-toggle-icon">‚ñ≤</span> Hide Details';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
                btn.innerHTML = '<span id="rankings-toggle-icon">‚ñº</span> Show Details';
            }
        }

        function initializeCharts() {
            // Only initialize once
            if (confidenceChart !== null) return;

            const modelPredictions = {{ result.model_predictions | tojson
        }};
        const modelMetrics = {{ result.model_metrics | tojson }};

        // Prepare data for confidence chart
        const modelNames = [];
        const confidences = [];
        const colors = [];

        const colorPalette = [
            'rgba(16, 185, 129, 0.8)',   // Green
            'rgba(59, 130, 246, 0.8)',   // Blue
            'rgba(245, 158, 11, 0.8)',   // Amber
            'rgba(239, 68, 68, 0.8)',    // Red
            'rgba(168, 85, 247, 0.8)'    // Purple
        ];

        let colorIndex = 0;
        for (const [modelKey, prediction] of Object.entries(modelPredictions)) {
            modelNames.push(modelKey.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()));
            confidences.push((prediction.confidence * 100).toFixed(1));
            colors.push(colorPalette[colorIndex % colorPalette.length]);
            colorIndex++;
        }

        // Create Confidence Comparison Chart
        const ctxConfidence = document.getElementById('confidenceChart');
        if (ctxConfidence) {
            confidenceChart = new Chart(ctxConfidence, {
                type: 'bar',
                data: {
                    labels: modelNames,
                    datasets: [{
                        label: 'Confidence (%)',
                        data: confidences,
                        backgroundColor: colors,
                        borderColor: colors.map(c => c.replace('0.8', '1')),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return 'Confidence: ' + context.parsed.y + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: function (value) { return value + '%'; } },
                            title: { display: true, text: 'Confidence (%)' }
                        },
                        x: { title: { display: true, text: 'Model' } }
                    }
                }
            });
        }

        // Create Performance Metrics Radar Chart
        if (Object.keys(modelMetrics).length > 0) {
            const metricsDatasets = [];
            colorIndex = 0;

            for (const [modelKey, metrics] of Object.entries(modelMetrics)) {
                metricsDatasets.push({
                    label: modelKey.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                    data: [
                        (metrics.val_accuracy * 100).toFixed(1),
                        (metrics.precision * 100).toFixed(1),
                        (metrics.recall * 100).toFixed(1),
                        (metrics.f1_score * 100).toFixed(1)
                    ],
                    backgroundColor: colorPalette[colorIndex % colorPalette.length].replace('0.8', '0.2'),
                    borderColor: colorPalette[colorIndex % colorPalette.length],
                    borderWidth: 2,
                    pointBackgroundColor: colorPalette[colorIndex % colorPalette.length],
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: colorPalette[colorIndex % colorPalette.length]
                });
                colorIndex++;
            }

            const ctxMetrics = document.getElementById('metricsChart');
            if (ctxMetrics) {
                metricsChart = new Chart(ctxMetrics, {
                    type: 'radar',
                    data: {
                        labels: ['Accuracy', 'Precision', 'Recall', 'F1 Score'],
                        datasets: metricsDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: { legend: { position: 'bottom' } },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { callback: function (value) { return value + '%'; } }
                            }
                        }
                    }
                });
            }
        }
    }
    </script>
    {% endif %}


    <!-- Soil Prediction Results -->
    {% if result.irrigation_needed is defined %}
    <div class="card result-card">
        <div class="result-header">
            <div class="result-icon soil-icon">üíß</div>
            <div class="result-title">
                <h3>Soil Analysis</h3>
                <p class="result-subtitle">Irrigation and moisture assessment</p>
            </div>
        </div>

        <div class="result-main">
            <div class="soil-metrics">
                <div
                    class="metric-card {% if result.irrigation_needed == 1 %}metric-warning{% else %}metric-success{% endif %}">
                    <div class="metric-icon">
                        {% if result.irrigation_needed == 1 %}
                        üöø
                        {% else %}
                        ‚úì
                        {% endif %}
                    </div>
                    <div class="metric-content">
                        <div class="metric-label">Irrigation Status</div>
                        <div class="metric-value">
                            {% if result.irrigation_needed == 1 %}
                            Required
                            {% else %}
                            Not Required
                            {% endif %}
                        </div>
                        <div class="metric-detail">Probability: {{ (result.irrigation_probability * 100) | round(1) }}%
                        </div>
                    </div>
                </div>

                <div class="metric-card metric-info">
                    <div class="metric-icon">üí¶</div>
                    <div class="metric-content">
                        <div class="metric-label">Predicted Moisture</div>
                        <div class="metric-value">{{ result.predicted_moisture | round(1) }}%</div>
                        <div class="metric-detail">Soil moisture level</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recommended Crops Section -->
        {% if result.recommended_crops and result.recommended_crops|length > 0 %}
        <div class="crops-recommendation-section">
            <h4 class="crops-section-title">üåæ Recommended Crops for These Conditions</h4>
            <p class="crops-section-subtitle">Based on soil parameters and climate suitability</p>

            <div class="recommended-crops-grid">
                {% for crop in result.recommended_crops %}
                <div class="recommended-crop-card">
                    <div class="crop-rank">#{{ loop.index }}</div>
                    <div class="crop-info">
                        <div class="crop-name-small">{{ crop.name }}</div>
                        <div class="suitability-bar-container">
                            <div class="suitability-bar" style="width: {{ crop.suitability }}%">
                                <span class="suitability-text">{{ crop.suitability | round(0) | int }}%</span>
                            </div>
                        </div>
                        <div class="suitability-label">Suitability Score</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div class="result-actions">
        <a href="/" class="btn btn-primary">‚Üê New Prediction</a>
        <button onclick="window.print()" class="btn btn-secondary">üñ®Ô∏è Print Results</button>
    </div>
</section>

<style>
    /* Result Card Styles */
    .result-card {
        margin-bottom: 2rem;
        overflow: hidden;
    }

    .result-header {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 2px solid var(--border-color);
    }

    .result-icon {
        width: 80px;
        height: 80px;
        border-radius: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        flex-shrink: 0;
    }

    .crop-icon {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(52, 211, 153, 0.2));
        border: 2px solid var(--primary-green);
    }

    .soil-icon {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(96, 165, 250, 0.2));
        border: 2px solid #3b82f6;
    }

    .result-title h3 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
    }

    .result-subtitle {
        color: var(--text-muted);
        font-size: 0.875rem;
    }

    .result-main {
        padding-top: 2rem;
    }

    /* Crop Name Display */
    .crop-name {
        font-size: 3rem;
        font-weight: 700;
        color: var(--primary-green);
        text-align: center;
        padding: 1.5rem;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.05));
        border-radius: 1rem;
        margin-bottom: 2rem;
        text-transform: capitalize;
        letter-spacing: 1px;
    }

    /* Confidence Section */
    .confidence-section {
        max-width: 600px;
        margin: 0 auto;
    }

    .confidence-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.75rem;
    }

    .confidence-bar-container {
        background: var(--input-bg);
        border-radius: 1rem;
        height: 3rem;
        overflow: hidden;
        border: 2px solid var(--border-color);
        margin-bottom: 1rem;
        position: relative;
    }

    .confidence-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-green), var(--primary-green-light));
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 1rem;
        transition: width 1s ease-out;
        position: relative;
        overflow: hidden;
    }

    .confidence-bar::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
        0% {
            left: -100%;
        }

        100% {
            left: 100%;
        }
    }

    .confidence-text {
        font-size: 1.25rem;
        font-weight: 700;
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        position: relative;
        z-index: 1;
    }

    .confidence-indicator {
        text-align: center;
        margin-top: 1rem;
    }

    /* Badges */
    .badge {
        display: inline-block;
        padding: 0.5rem 1.5rem;
        border-radius: 2rem;
        font-weight: 600;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .badge-high {
        background: linear-gradient(135deg, var(--primary-green), var(--primary-green-dark));
        color: white;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .badge-medium {
        background: linear-gradient(135deg, var(--accent-amber), var(--accent-amber-dark));
        color: white;
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }

    .badge-low {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    /* Soil Metrics */
    .soil-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
    }

    .metric-card {
        padding: 1.5rem;
        border-radius: 1rem;
        display: flex;
        align-items: center;
        gap: 1.25rem;
        border: 2px solid;
        transition: all 0.3s ease;
    }

    .metric-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-xl);
    }

    .metric-success {
        background: rgba(16, 185, 129, 0.1);
        border-color: var(--primary-green);
    }

    .metric-warning {
        background: rgba(245, 158, 11, 0.1);
        border-color: var(--accent-amber);
    }

    .metric-info {
        background: rgba(59, 130, 246, 0.1);
        border-color: #3b82f6;
    }

    .metric-icon {
        font-size: 2.5rem;
        flex-shrink: 0;
    }

    .metric-content {
        flex: 1;
    }

    .metric-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.25rem;
    }

    .metric-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
    }

    .metric-detail {
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    /* Crop Recommendations Section */
    .crops-recommendation-section {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid var(--border-color);
    }

    .crops-section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        text-align: center;
    }

    .crops-section-subtitle {
        font-size: 0.875rem;
        color: var(--text-muted);
        text-align: center;
        margin-bottom: 1.5rem;
    }

    .recommended-crops-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .recommended-crop-card {
        background: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 1rem;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .recommended-crop-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-green);
    }

    .crop-rank {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-green), var(--primary-green-dark));
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        font-weight: 700;
        flex-shrink: 0;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .crop-info {
        flex: 1;
    }

    .crop-name-small {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.75rem;
        text-transform: capitalize;
    }

    .suitability-bar-container {
        background: var(--input-bg);
        border-radius: 0.5rem;
        height: 2rem;
        overflow: hidden;
        border: 1px solid var(--border-color);
        margin-bottom: 0.5rem;
        position: relative;
    }

    .suitability-bar {
        height: 100%;
        background: linear-gradient(90deg, rgba(16, 185, 129, 0.6), rgba(16, 185, 129, 0.9));
        display: flex;
        align-items: center;
        justify-content: center;
        transition: width 1s ease-out;
        position: relative;
    }

    .suitability-text {
        font-size: 0.875rem;
        font-weight: 700;
        color: white;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        position: relative;
        z-index: 1;
    }

    .suitability-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Comparison Card Styles */
    .comparison-card {
        margin-top: 2rem;
    }

    .comparison-header h3 {
        font-size: 1.5rem;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .comparison-subtitle {
        color: var(--text-muted);
        font-size: 0.875rem;
    }

    .comparison-body {
        padding-top: 1.5rem;
    }

    .crop-selector {
        margin-bottom: 2rem;
    }

    .crop-selector label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--text-secondary);
    }

    .crop-dropdown {
        width: 100%;
        padding: 1rem;
        border: 2px solid var(--border-color);
        border-radius: 0.75rem;
        background: var(--input-bg);
        color: var(--text-primary);
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .crop-dropdown:hover {
        border-color: var(--primary-green);
    }

    .crop-dropdown:focus {
        outline: none;
        border-color: var(--primary-green);
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }

    .comparison-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .comparison-column {
        padding: 1.5rem;
        border-radius: 1rem;
        border: 2px solid var(--border-color);
        text-align: center;
        position: relative;
        transition: all 0.3s ease;
    }

    .comparison-column.recommended {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.05));
        border-color: var(--primary-green);
    }

    .comparison-column.alternative {
        background: var(--bg-secondary);
    }

    .column-badge {
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--primary-green);
        color: white;
        padding: 0.25rem 1rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .comparison-column.alternative .column-badge {
        background: var(--accent-amber);
    }

    .comparison-column h4 {
        font-size: 1.5rem;
        color: var(--text-primary);
        margin: 1rem 0;
    }

    .comparison-column .confidence-display {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-green);
        margin: 0.5rem 0;
    }

    .comparison-column .confidence-label {
        font-size: 0.875rem;
        color: var(--text-muted);
        text-transform: uppercase;
    }

    .all-crops-list {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid var(--border-color);
    }

    .all-crops-list h4 {
        font-size: 1.25rem;
        color: var(--text-primary);
        margin-bottom: 1rem;
    }

    .crops-ranking {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .rank-item {
        display: grid;
        grid-template-columns: 40px 150px 1fr 80px;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem;
        background: var(--bg-secondary);
        border-radius: 0.5rem;
        transition: all 0.3s ease;
    }

    .rank-item:hover {
        background: var(--bg-card-hover);
        transform: translateX(4px);
    }

    .rank-number {
        font-weight: 700;
        color: var(--primary-green);
        font-size: 1.125rem;
    }

    .rank-crop {
        font-weight: 600;
        color: var(--text-primary);
        text-transform: capitalize;
    }

    .rank-bar-container {
        background: var(--input-bg);
        border-radius: 0.5rem;
        height: 1.5rem;
        overflow: hidden;
    }

    .rank-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-green), var(--primary-green-light));
        transition: width 1s ease-out;
    }

    .rank-confidence {
        font-weight: 600;
        color: var(--text-secondary);
        text-align: right;
    }

    /* Model Comparison Styles */
    .model-comparison-card {
        margin-top: 2rem;
    }

    .model-comparison-header {
        text-align: center;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border-color);
    }

    .model-comparison-header h3 {
        font-size: 1.5rem;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .model-comparison-subtitle {
        color: var(--text-muted);
        font-size: 0.875rem;
        margin-bottom: 1rem;
    }

    .toggle-comparison-btn {
        background: linear-gradient(135deg, var(--primary-green), var(--primary-green-dark));
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }

    .toggle-comparison-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }

    .model-comparison-content {
        padding-top: 2rem;
    }

    .model-predictions-section,
    .model-metrics-section {
        margin-bottom: 2rem;
    }

    .model-predictions-section h4,
    .model-metrics-section h4 {
        font-size: 1.25rem;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .metrics-subtitle {
        font-size: 0.875rem;
        color: var(--text-muted);
        margin-bottom: 1rem;
    }

    /* Predictions Table */
    .predictions-table,
    .metrics-table {
        background: var(--bg-secondary);
        border-radius: 0.75rem;
        overflow: hidden;
        border: 2px solid var(--border-color);
    }

    .predictions-header,
    .metrics-header {
        display: grid;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(52, 211, 153, 0.1));
        padding: 1rem;
        font-weight: 700;
        color: var(--text-primary);
        border-bottom: 2px solid var(--border-color);
    }

    .predictions-header {
        grid-template-columns: 2fr 2fr 2fr 1fr;
        gap: 1rem;
    }

    .prediction-row {
        display: grid;
        grid-template-columns: 2fr 2fr 2fr 1fr;
        gap: 1rem;
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        transition: background 0.2s ease;
    }

    .prediction-row:last-child {
        border-bottom: none;
    }

    .prediction-row:hover {
        background: var(--bg-card-hover);
    }

    .model-name {
        font-weight: 600;
        color: var(--text-primary);
    }

    .crop-name-pred {
        color: var(--primary-green);
        font-weight: 600;
        text-transform: capitalize;
    }

    .pred-col-confidence {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .mini-confidence-bar {
        flex: 1;
        background: var(--input-bg);
        border-radius: 0.25rem;
        height: 1.25rem;
        overflow: hidden;
    }

    .mini-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-green), var(--primary-green-light));
        transition: width 0.5s ease-out;
    }

    .confidence-value {
        font-weight: 600;
        color: var(--text-secondary);
        min-width: 50px;
    }

    .match-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-align: center;
    }

    .match-yes {
        background: rgba(16, 185, 129, 0.2);
        color: var(--primary-green);
        border: 1px solid var(--primary-green);
    }

    .match-no {
        background: rgba(245, 158, 11, 0.2);
        color: var(--accent-amber);
        border: 1px solid var(--accent-amber);
    }

    /* Metrics Table */
    .metrics-header {
        grid-template-columns: 2fr repeat(4, 1fr);
        gap: 1rem;
    }

    .metric-row {
        display: grid;
        grid-template-columns: 2fr repeat(4, 1fr);
        gap: 1rem;
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        transition: background 0.2s ease;
    }

    .metric-row:last-child {
        border-bottom: none;
    }

    .metric-row:hover {
        background: var(--bg-card-hover);
    }

    .metric-value {
        font-weight: 600;
        color: var(--text-secondary);
    }

    /* Action Buttons */
    .result-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
        flex-wrap: wrap;
    }

    .btn {
        padding: 1rem 2rem;
        border-radius: 0.75rem;
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        box-shadow: var(--shadow-md);
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary-green), var(--primary-green-dark));
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
        background: var(--bg-secondary);
        color: var(--text-primary);
        border: 2px solid var(--border-color);
    }

    .btn-secondary:hover {
        background: var(--bg-card-hover);
        transform: translateY(-2px);
    }

    /* Charts Section Styles */
    .model-charts-section {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 2px solid var(--border-color);
    }

    .model-charts-section h4 {
        font-size: 1.25rem;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
    }

    .charts-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 2rem;
        margin-bottom: 1rem;
    }

    .chart-container {
        background: var(--bg-secondary);
        padding: 1.5rem;
        border-radius: 1rem;
        border: 2px solid var(--border-color);
    }

    .chart-container h5 {
        font-size: 1rem;
        color: var(--text-secondary);
        margin-bottom: 1rem;
        text-align: center;
    }

    .chart-container canvas {
        max-height: 300px;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .crop-name {
            font-size: 2rem;
        }

        .result-icon {
            width: 60px;
            height: 60px;
            font-size: 2rem;
        }

        .result-title h3 {
            font-size: 1.25rem;
        }

        .soil-metrics {
            grid-template-columns: 1fr;
        }

        .comparison-grid {
            grid-template-columns: 1fr;
        }

        .rank-item {
            grid-template-columns: 30px 100px 1fr 60px;
            gap: 0.5rem;
        }

        .charts-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Print Styles */
    @media print {
        .result-actions {
            display: none;
        }

        body {
            background: white;
        }

        .card {
            border: 2px solid #333;
            box-shadow: none;
        }
    }
</style>
{% endblock %}